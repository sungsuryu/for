<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.knia.foreign.exchange.dao.mapper.CommonCodeMapper">


	
	<select id="selectUser" parameterType="loginVO" resultMap="mapUserVO">
			SELECT
				USER_ID, USER_NM, PASSWORD, 
				INSUR_CD, EML_ADDR, CELL_NUM
			FROM
				TB_FOR_USER
			WHERE
				USER_ID=#{loginId} 
				AND PASSWORD=#{password}
				AND IS_DEL='N' 
				AND USE_YN='Y' 
				AND IS_APPROVE='Y'
	</select>
	
	<select id="countUser" parameterType="loginVO" resultType="int">
			SELECT
				COUNT(USER_ID) FROM TB_FOR_USER
			WHERE
				USER_ID=#{loginId} 
				AND PASSWORD=#{password}
				AND IS_DEL='N' 
				AND USE_YN='Y' 
				AND IS_APPROVE='Y'
	</select>

	<insert id="insertAuthHist" parameterType="loginAuthHistVO">
			INSERT INTO TB_FOR_LOGIN_AUTH_HIST (
				USER_ID, 
				APPROVE_TIMESTAMP, 
				AUTH_NUM,
				IS_EXP, 
				IS_DEL, 
				INSRT_DATE
			) VALUES (
				#{userId}, 
				#{approveTimestamp}, 
				#{authNum}, 
				'N', 
				'N',
				#{insrtDate}
			)
	</insert>
	
	<select id="selectAuthNum" parameterType="loginAuthHistVO" resultType="String">
			SELECT
				AUTH_NUM
			FROM
				TB_FOR_LOGIN_AUTH_HIST
			WHERE
				USER_ID=#{userId}
				AND IS_EXP='N'
				AND IS_DEL='N'
				AND INSRT_DATE > DATE_SUB(#{insrtDate}, INTERVAL 2 MINUTE)
			ORDER BY
				INSRT_DATE DESC LIMIT 1
			
	</select>
</mapper>